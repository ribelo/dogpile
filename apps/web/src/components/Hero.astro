---
import { t, type Language } from '../i18n'
import { getPhotoUrl } from '../utils/photo-url'

const lang = (Astro.currentLocale as Language) || 'pl'

const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:8787'
let featuredDog = null

try {
  const response = await fetch(`${API_URL}/dogs/random`)
  if (response.ok) {
    featuredDog = await response.json()
  }
} catch (e) {
  console.error("Failed to fetch random dog for Hero", e)
}

const displayName = featuredDog?.name || 'Burek'
const displayLocation = featuredDog?.locationCity || 'Krak√≥w'
const displayUrl = featuredDog ? `/dogs/${featuredDog.id}` : '#dogs'

// Use professional photo if available, fallback to first original photo, then hardcoded Unsplash
const displayPhoto = featuredDog 
  ? getPhotoUrl(featuredDog.photosGenerated?.[0] || featuredDog.photos?.[0], 'lg')
  : "https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=600&q=80&auto=format&fit=crop"

const displaySrcset = featuredDog 
  ? undefined // getPhotoUrl returns a single URL; we can improve this later with responsive processed images if needed
  : `
      https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=400&q=80&auto=format&fit=crop 400w,
      https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=600&q=80&auto=format&fit=crop 600w,
      https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=800&q=80&auto=format&fit=crop 800w,
      https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=1200&q=80&auto=format&fit=crop 1200w
    `
---

 <header id="hero-section" class="relative z-10 max-w-6xl mx-auto px-4 md:px-6 grid md:grid-cols-2 gap-8 md:gap-12 items-center py-12 md:py-24">
  <div class="animate-[unfold_1s_ease-out]">
    <span id="hero-badge" class="inline-flex items-center gap-1 px-3 py-1 bg-sys-heart-soft/30 text-sys-ink-primary font-bold rounded-full text-xs md:text-sm mb-4 transform rotate-1 border border-sys-heart-soft/50">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>
      </svg>
      {t('hero.badge', lang)}
    </span>
    <h1 id="hero-headline" class="font-title text-4xl md:text-6xl lg:text-7xl font-black text-sys-ink-primary mb-6 leading-[0.9] lowercase" set:html={t('hero.headline', lang)} />
    <p id="hero-subheadline" class="text-lg md:text-xl text-sys-ink-primary/80 mb-8 max-w-md leading-relaxed">
      {t('hero.subheadline', lang)}
    </p>
    <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
      <a id="hero-cta-button" href="#dogs" class="w-full sm:w-auto min-h-[44px] justify-center bg-sys-ink-primary text-sys-paper-base font-bold text-lg py-4 px-8 paper-edge hover:bg-sys-heart-core transition-colors flex items-center gap-2 no-underline">
        {t('hero.cta', lang)}
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-sys-heart-soft" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7 14c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-5-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3-3c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
        </svg>
      </a>
      <div id="hero-stats" class="flex items-center gap-2 py-2" aria-hidden="true">
        <div class="flex -space-x-3">
          <img 
            src="https://images.unsplash.com/photo-1517841905240-472988babdf9?w=80&q=80&auto=format&fit=crop" 
            width="40" 
            height="40" 
            class="w-10 h-10 rounded-full border-2 border-sys-paper-base object-cover" 
            alt="" 
          />
          <img 
            src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=80&q=80&auto=format&fit=crop" 
            width="40" 
            height="40" 
            class="w-10 h-10 rounded-full border-2 border-sys-paper-base object-cover" 
            alt="" 
          />
          <img 
            src="https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=80&q=80&auto=format&fit=crop" 
            width="40" 
            height="40" 
            class="w-10 h-10 rounded-full border-2 border-sys-paper-base object-cover" 
            alt="" 
          />
        </div>
        <span class="text-sm font-bold opacity-70">{t('hero.stats', lang)}</span>
      </div>
    </div>
  </div>

  <div class="relative hidden md:block">
    <!-- Background polaroids (decorative) -->
    <div class="absolute -top-12 -left-12 w-40 h-48 bg-sys-paper-card p-3 pb-10 shadow-lg -rotate-12 opacity-60 hidden md:block transform hover:rotate-0 transition-transform duration-500">
      <div class="w-full h-full bg-sys-ink-primary/5"></div>
    </div>
    <div class="absolute -bottom-10 -right-8 w-32 h-40 bg-sys-paper-card p-2.5 pb-8 shadow-lg rotate-12 opacity-50 hidden md:block transform hover:rotate-0 transition-transform duration-500">
      <div class="w-full h-full bg-sys-ink-primary/5"></div>
    </div>

    <!-- Main polaroid -->
    <a id="hero-featured-dog-card" href={displayUrl} class="relative z-10 block bg-sys-paper-card p-4 w-full max-w-[420px] mx-auto shadow-2xl animate-breath rotate-2 transform hover:rotate-0 transition-all duration-500 group no-underline">
      <div class="relative w-full aspect-[4/5] overflow-hidden rounded-sm bg-sys-ink-primary/5">
        <img 
          src={displayPhoto}
          srcset={displaySrcset}
          sizes="(max-width: 768px) 100vw, 420px"
          width="420"
          height="525"
          alt={`Happy dog named ${displayName}`} 
          class="nostalgia-img w-full h-full object-cover grayscale-[0.2] sepia-[0.1] group-hover:grayscale-0 group-hover:sepia-0 transition-all duration-500"
          fetchpriority="high"
          decoding="async"
        />
      </div>
      <div class="h-24 flex flex-col justify-center items-center text-center px-2">
        <p id="hero-dog-name" class="font-title font-bold text-3xl text-sys-ink-primary/90 -rotate-1 truncate w-full">{displayName}</p>
        <p id="hero-dog-location" class="text-sm text-sys-ink-primary/50 font-narrative italic">
          {t('hero.waitingIn', lang).replace('{location}', displayLocation)}
        </p>
      </div>
    </a>
  </div>
</header>

<style>
  @keyframes unfold {
    from { transform: scaleY(0); opacity: 0; }
    to { transform: scaleY(1); opacity: 1; }
  }
  @keyframes breath {
    0%, 100% { transform: rotate(2deg) scale(1); }
    50% { transform: rotate(1.5deg) scale(1.02); }
  }
  .animate-breath {
    animation: breath 8s ease-in-out infinite;
  }
</style>
