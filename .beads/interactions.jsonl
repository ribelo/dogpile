{"id":"dogpile-25a","title":"Implement semantic search in API","description":"Add semantic search endpoint to API worker.\n\nFlow:\n1. User query -\u003e OpenRouter embed -\u003e vector\n2. Vectorize similarity search -\u003e dog IDs\n3. D1 fetch dog records by IDs\n4. Apply hard filters (city, size, etc)\n5. Return results\n\nEndpoint: GET /search?q=friendly+family+dog\u0026city=warszawa","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T20:33:56.882888614+01:00","updated_at":"2025-12-29T00:15:00.604580373+01:00","closed_at":"2025-12-29T00:15:00.604580373+01:00","close_reason":"Implemented API endpoints with CORS for dogs listing, detail, search, and shelters","dependencies":[{"issue_id":"dogpile-25a","depends_on_id":"dogpile-4ds","type":"blocks","created_at":"2025-12-28T20:34:03.494903607+01:00","created_by":"daemon"},{"issue_id":"dogpile-25a","depends_on_id":"dogpile-cv8","type":"blocks","created_at":"2025-12-28T20:43:39.455545855+01:00","created_by":"daemon"}]}
{"id":"dogpile-2o2","title":"Build first real shelter adapter","description":"Create the first production shelter adapter as a template for others.\n\nPick a shelter with:\n- Stable URLs or external IDs\n- Reasonable HTML structure\n- Good variety of dog data\n\nAdapter must:\n- Compute fingerprint from stable source data (URL or ID)\n- Extract rawDescription for AI processing\n- Return RawDogData with all available fields\n\nThis will serve as the reference implementation for other adapters.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-28T20:32:35.255007444+01:00","updated_at":"2025-12-28T21:18:42.901852371+01:00","closed_at":"2025-12-28T21:18:42.901852371+01:00","close_reason":"Implemented TOZ Jawor adapter with JSON API integration"}
{"id":"dogpile-3ul","title":"Implement PhotoStore for R2","description":"Implement PhotoStore interface for dual R2 bucket storage.\n\nBuckets:\n- dogpile-photos-original: scraped shelter photos\n- dogpile-photos-generated: AI-generated images\n\nKey format: {dog_id}/{index}.jpg\n\nInterface in packages/core/src/services/image-store.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T20:33:23.319091592+01:00","updated_at":"2025-12-29T00:11:05.406799898+01:00","closed_at":"2025-12-29T00:11:05.406799898+01:00","close_reason":"Implemented PhotoStoreLive for R2 bucket operations"}
{"id":"dogpile-47n","title":"Generate D1 migrations","description":"Run drizzle-kit generate to create SQL migrations from schema.\n\nThen apply to D1:\n- Local: wrangler d1 execute dogpile-db --local --file migrations/0001_*.sql\n- Remote: wrangler d1 execute dogpile-db --remote --file migrations/0001_*.sql","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T20:33:41.101118975+01:00","updated_at":"2025-12-29T00:11:42.076014468+01:00","closed_at":"2025-12-29T00:11:42.076014468+01:00","close_reason":"Generated D1 migration with all tables and indexes"}
{"id":"dogpile-4ds","title":"Implement EmbeddingService with OpenRouter","description":"Implement EmbeddingService interface using OpenRouter embeddings API.\n\nUse gemini-embedding-001 model for Polish language support.\n\nInterface in packages/core/src/services/embedding.ts:\n- embed(text) -\u003e vector\n- embedBatch(texts) -\u003e vectors\n\nAdd retry logic for API failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T20:33:15.162389594+01:00","updated_at":"2025-12-28T20:41:20.089709325+01:00","closed_at":"2025-12-28T20:41:20.089709325+01:00","close_reason":"Superseded by more detailed OpenRouter tasks"}
{"id":"dogpile-4jr","title":"Implement AIExtractionService with OpenRouter/Gemini","description":"Implement the AIExtractionService interface using OpenRouter API with gemini-embedding-001 model.\n\nTwo extraction passes:\n1. Text extraction: name, sex, age, breed, size, weight, personality, health, compatibility, location\n2. Photo extraction: breed confirmation, fur, color, ears, tail, size/age refinement\n\nMust handle nullable fields gracefully - shelters have inconsistent data.\n\nOutput should match TextExtractionResult and PhotoExtractionResult interfaces in packages/core/src/services/ai-extraction.ts","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-28T20:32:15.61846583+01:00","updated_at":"2025-12-28T20:41:10.567857653+01:00","closed_at":"2025-12-28T20:41:10.567857653+01:00","close_reason":"Superseded by more detailed OpenRouter tasks"}
{"id":"dogpile-7we","title":"Implement DescriptionGenerator service","description":"Create DescriptionGenerator Effect service for generating consistent, warm dog bios.\n\n## Purpose\nGenerate a consistent 'Dogpile style' description for every dog instead of showing raw shelter text.\nThis ensures uniform tone across all listings regardless of shelter writing quality.\n\n## Depends on\n- OpenRouterClient (dogpile-czv)\n- JSON Schemas (dogpile-ogp)\n- AI Config (dogpile-u1d)\n\n## Interface\n```typescript\ninterface DescriptionGenerator {\n  generate: (dogData: DogData) =\u003e Effect\u003cGeneratedBio, GenerationError\u003e\n}\n\ninterface DogData {\n  name: string\n  breedEstimates: BreedEstimate[]\n  ageEstimate: AgeEstimate | null\n  sizeEstimate: SizeEstimate | null\n  personalityTags: string[]\n  healthInfo: { vaccinated, sterilized, chipped }\n  compatibility: { kids, dogs, cats }\n  locationCity: string | null\n  isFoster: boolean\n  urgent: boolean\n}\n```\n\n## Style Guide (from design system)\n- Tone: hopeful, warm, empathetic\n- Voice: active, present tense\n- DO: Focus on personality, future with family, unique quirks\n- DON'T: Bureaucratic language, sad backstory focus, 'Subject is...'\n- Length: 2-3 short paragraphs\n- Language: Polish\n\n## System Prompt Structure\n1. You are writing for Dogpile, a dog adoption platform\n2. Style guide rules\n3. Example good/bad descriptions\n4. Input format explanation\n\n## Implementation\n1. Use OpenRouterClient.responses() with MODEL_DESCRIPTION_GEN\n2. Feed structured DogData (NOT raw shelter text) to avoid hallucination\n3. response_format: { type: 'json_schema', json_schema: DogBioSchema }\n4. Validate output\n\nLocation: packages/core/src/services/ai/description-generator.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:42:55.222898808+01:00","updated_at":"2025-12-28T21:07:22.998085091+01:00","closed_at":"2025-12-28T21:07:22.998085091+01:00","close_reason":"Implemented DescriptionGenerator for dog bios","dependencies":[{"issue_id":"dogpile-7we","depends_on_id":"dogpile-czv","type":"blocks","created_at":"2025-12-28T20:43:21.970476559+01:00","created_by":"daemon"},{"issue_id":"dogpile-7we","depends_on_id":"dogpile-u1d","type":"blocks","created_at":"2025-12-28T20:43:21.985301239+01:00","created_by":"daemon"},{"issue_id":"dogpile-7we","depends_on_id":"dogpile-ogp","type":"blocks","created_at":"2025-12-28T20:43:22.000232473+01:00","created_by":"daemon"},{"issue_id":"dogpile-7we","depends_on_id":"dogpile-ada","type":"blocks","created_at":"2025-12-28T20:51:25.214484121+01:00","created_by":"daemon"}]}
{"id":"dogpile-ada","title":"Create prompt template files","description":"Create markdown prompt files that are loaded at runtime. Prompts should NOT be hardcoded in code.\n\n## Directory Structure\n```\npackages/core/prompts/\n├── text-extraction.md     # System prompt for extracting data from shelter text\n├── photo-analysis.md      # System prompt for analyzing dog photos\n├── description-gen.md     # System prompt for generating dog bios\n└── README.md              # Documentation on prompt format and variables\n```\n\n## Prompt File Format\nEach .md file contains:\n1. System prompt content\n2. Variable placeholders using {{VARIABLE}} syntax\n3. Comments (will be stripped) using \u003c!-- --\u003e \n\nExample text-extraction.md:\n```markdown\n\u003c!-- Variables: {{RAW_DESCRIPTION}} --\u003e\n\nJesteś ekspertem w analizie ogłoszeń adopcyjnych psów ze schronisk w Polsce.\n\nTwoim zadaniem jest wyekstrahowanie ustrukturyzowanych danych z tekstu ogłoszenia.\n\n## Zasady\n- Wszystkie pola opcjonalne - użyj null jeśli brak informacji\n- Wiek podaj w miesiącach (1 rok = 12 miesięcy)\n- Rasy wybieraj z podanej listy enum\n...\n```\n\n## Language Rules\n- Prompt content: POLISH (for LLM to respond in Polish)\n- Variable names: ENGLISH\n- Schema field names: ENGLISH\n- Enum values: ENGLISH\n\n## Implementation\n1. Create PromptLoader service that reads .md files\n2. Cache loaded prompts (they don't change at runtime)\n3. Support variable substitution: `{{VAR}}` -\u003e value\n4. Strip HTML comments before sending to LLM\n5. In development, reload on file change (optional)\n\n## Prompt Loading in Workers\nSince Cloudflare Workers can't read filesystem, prompts must be:\n- Bundled at build time (import as string)\n- Or stored in KV and loaded at runtime\n\nRecommend: Bundle at build time using Bun's text loader\n\nLocation: packages/core/prompts/","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:51:15.330965075+01:00","updated_at":"2025-12-28T21:02:48.412425874+01:00","closed_at":"2025-12-28T21:02:48.412425874+01:00","close_reason":"Created Polish prompt templates for AI extraction and bio generation"}
{"id":"dogpile-cv8","title":"Implement EmbeddingService","description":"Create EmbeddingService Effect service for generating vector embeddings.\n\n## Depends on\n- OpenRouterClient (dogpile-czv)\n- AI Config (dogpile-u1d)\n\n## Interface\n```typescript\ninterface EmbeddingService {\n  embed: (text: string) =\u003e Effect\u003creadonly number[], EmbeddingError\u003e\n  embedBatch: (texts: readonly string[]) =\u003e Effect\u003creadonly (readonly number[])[], EmbeddingError\u003e\n}\n```\n\n## Implementation\n1. Use OpenRouterClient.embeddings() with MODEL_EMBEDDING\n2. Default model: google/gemini-embedding-001 (good for Polish)\n3. Batch requests for efficiency (Embeddings API supports array input)\n\n## API Call\n```typescript\nPOST /api/v1/embeddings\n{\n  model: 'google/gemini-embedding-001',\n  input: ['text1', 'text2', ...]\n}\n```\n\n## Response\n```typescript\n{\n  data: [\n    { embedding: number[], index: 0 },\n    { embedding: number[], index: 1 },\n    ...\n  ]\n}\n```\n\n## Usage\n- Called by embedder worker for new dogs\n- Called by API worker for search queries\n- Cache embeddings - they're deterministic\n\nLocation: packages/core/src/services/ai/embedding.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:43:09.574307686+01:00","updated_at":"2025-12-28T21:07:23.014162817+01:00","closed_at":"2025-12-28T21:07:23.014162817+01:00","close_reason":"Implemented EmbeddingService with OpenRouter embeddings","dependencies":[{"issue_id":"dogpile-cv8","depends_on_id":"dogpile-czv","type":"blocks","created_at":"2025-12-28T20:43:22.014279449+01:00","created_by":"daemon"},{"issue_id":"dogpile-cv8","depends_on_id":"dogpile-u1d","type":"blocks","created_at":"2025-12-28T20:43:22.029780721+01:00","created_by":"daemon"}]}
{"id":"dogpile-czv","title":"Create OpenRouterClient base service","description":"Implement low-level OpenRouterClient Effect service for all OpenRouter API interactions.\n\n## Endpoints\n- Responses API: POST /api/v1/responses (new stateless API, NOT legacy /chat/completions)\n- Embeddings API: POST /api/v1/embeddings\n\n## Responsibilities\n- Authentication: Bearer token from OPENROUTER_API_KEY\n- Retry logic: Exponential backoff on 429 (rate limit) and 5xx errors\n- Error mapping to tagged Effect errors\n\n## Methods\n```typescript\ninterface OpenRouterClient {\n  responses: (request: ResponsesRequest) =\u003e Effect\u003cResponsesResult, OpenRouterError\u003e\n  embeddings: (request: EmbeddingsRequest) =\u003e Effect\u003cEmbeddingsResult, OpenRouterError\u003e\n}\n```\n\n## Error Types\n- OpenRouterError: { status, body, code }\n- RateLimitError: extends OpenRouterError (triggers retry)\n- SchemaValidationError: { issues } (response didn't match expected schema)\n\n## Configuration\nRead from Effect.Config:\n- OPENROUTER_API_KEY (secret, required)\n- OPENROUTER_BASE_URL (optional, default https://openrouter.ai/api/v1)\n\nLocation: packages/core/src/services/openrouter/client.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:41:35.089339+01:00","updated_at":"2025-12-28T21:00:44.690824759+01:00","closed_at":"2025-12-28T21:00:44.690824759+01:00","close_reason":"Implemented OpenRouterClient with responses/embeddings endpoints, retry logic, and proper config"}
{"id":"dogpile-hjs","title":"Wire AI extraction into scraper-processor pipeline","description":"Integrate AIExtractionService into scraper-processor worker.\n\nFlow:\n1. Scraper returns RawDogData with fingerprint + rawDescription\n2. If new dog (fingerprint not in DB):\n   - Run text extraction on rawDescription\n   - Download photos to R2\n   - Run photo extraction on photos\n   - Merge results and store in D1\n   - Queue for embedding generation\n3. If existing dog (fingerprint match):\n   - Just update lastSeenAt\n\nRequires dogpile-4jr (AIExtractionService) and dogpile-2o2 (shelter adapter) to be complete.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:32:45.042624916+01:00","updated_at":"2025-12-29T00:07:44.509388314+01:00","closed_at":"2025-12-29T00:07:44.509388314+01:00","close_reason":"Integrated AI extraction into scraper-processor pipeline","dependencies":[{"issue_id":"dogpile-hjs","depends_on_id":"dogpile-4jr","type":"blocks","created_at":"2025-12-28T20:32:59.76429578+01:00","created_by":"daemon"},{"issue_id":"dogpile-hjs","depends_on_id":"dogpile-2o2","type":"blocks","created_at":"2025-12-28T20:33:05.98802271+01:00","created_by":"daemon"},{"issue_id":"dogpile-hjs","depends_on_id":"dogpile-zv5","type":"blocks","created_at":"2025-12-28T20:43:31.530020352+01:00","created_by":"daemon"},{"issue_id":"dogpile-hjs","depends_on_id":"dogpile-we6","type":"blocks","created_at":"2025-12-28T20:43:31.551671635+01:00","created_by":"daemon"},{"issue_id":"dogpile-hjs","depends_on_id":"dogpile-7we","type":"blocks","created_at":"2025-12-28T20:43:31.56704343+01:00","created_by":"daemon"},{"issue_id":"dogpile-hjs","depends_on_id":"dogpile-cv8","type":"blocks","created_at":"2025-12-28T20:43:31.582608143+01:00","created_by":"daemon"}]}
{"id":"dogpile-io3","title":"Add generatedBio field to Dog schema","description":"Update Dog schema to store AI-generated biography separately from rawDescription.\n\n## Schema Changes\n```sql\ndog:\n  + generatedBio TEXT     -- AI-generated 'Dogpile style' description\n  + bioGeneratedAt INTEGER -- When bio was generated (for cache invalidation)\n```\n\n## Domain Type Update\npackages/core/src/domain/dog.ts:\n```typescript\ngeneratedBio: Schema.NullOr(Schema.String),\nbioGeneratedAt: Schema.NullOr(Schema.Date),\n```\n\n## Frontend Display Logic\n- If generatedBio exists: show it\n- If not: show rawDescription as fallback\n- Never show both\n\n## Migration\n- Add columns to existing dogs table\n- Set generatedBio = null initially\n- Bio will be generated on next scrape or via backfill job","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T20:43:53.456553771+01:00","updated_at":"2025-12-29T00:11:05.377889149+01:00","closed_at":"2025-12-29T00:11:05.377889149+01:00","close_reason":"Added generatedBio field to Dog domain and DB schema","dependencies":[{"issue_id":"dogpile-io3","depends_on_id":"dogpile-7we","type":"related","created_at":"2025-12-28T20:44:01.049570611+01:00","created_by":"daemon"}]}
{"id":"dogpile-ogp","title":"Define JSON Schemas for structured outputs","description":"Create Effect Schema definitions that generate JSON Schemas for OpenRouter structured outputs.\n\n## CRITICAL: Use structured outputs with strict: true\nDo NOT use prompt-based 'return JSON' - use OpenRouter's response_format parameter:\n```typescript\n{\n  response_format: {\n    type: 'json_schema',\n    json_schema: {\n      name: 'dog_extraction',\n      strict: true,\n      schema: { ... } // Generated from Effect Schema\n    }\n  }\n}\n```\n\n## Schemas to Define\n\n### TextExtractionSchema\nOutput of text analysis - what we extract from shelter description:\n- name, sex, ageEstimate, breedEstimates, sizeEstimate, weightEstimate\n- personalityTags[], healthInfo, compatibility\n- locationHints (foster/shelter, city mentions)\n\n### PhotoExtractionSchema\nOutput of photo analysis - physical traits:\n- breedEstimates, sizeEstimate, ageCategory\n- furLength, furType, colorPrimary, colorSecondary, colorPattern\n- earType, tailType\n\n### DogBioSchema\nOutput of description generation:\n- bio: string (the generated description)\n- tone: 'hopeful' | 'urgent' | 'gentle' (for validation)\n\n## Implementation\n1. Define using Effect Schema (packages/core/src/schemas/)\n2. Create utility to convert Effect Schema -\u003e JSON Schema for OpenRouter\n3. Create runtime decoders for response validation\n4. Ensure all optional fields use Schema.NullOr (strict mode requires explicit nullability)\n\nReference: https://openrouter.ai/docs/guides/features/structured-outputs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:42:12.374722448+01:00","updated_at":"2025-12-28T21:02:48.385249025+01:00","closed_at":"2025-12-28T21:02:48.385249025+01:00","close_reason":"Created Effect Schemas for text/photo extraction and dog bio with JSON Schema utility"}
{"id":"dogpile-qv7","title":"Create Cloudflare resources and configure wrangler","description":"Create all required Cloudflare resources for dogpile.extropy.club:\n\n## Resources to Create\n- D1 database: dogpile-db\n- KV namespace: dogpile-cache\n- R2 bucket: dogpile-photos-original\n- R2 bucket: dogpile-photos-generated\n- Vectorize index: dogpile-dogs\n- Queues: dogpile-scrape-jobs, dogpile-reindex-jobs\n\n## Domain Setup\n- Domain: extropy.club (already owned)\n- Subdomain: dogpile.extropy.club\n- Configure DNS and SSL\n\n## Steps\n1. Create resources via wrangler CLI or dashboard\n2. Update all wrangler.toml files with actual resource IDs\n3. Configure custom domain for web worker\n4. Set up OPENROUTER_API_KEY secret: `wrangler secret put OPENROUTER_API_KEY`\n5. Run initial D1 migrations\n\n## Wrangler Commands\n```bash\nwrangler d1 create dogpile-db\nwrangler kv:namespace create dogpile-cache\nwrangler r2 bucket create dogpile-photos-original\nwrangler r2 bucket create dogpile-photos-generated\nwrangler vectorize create dogpile-dogs --dimensions 768 --metric cosine\nwrangler queues create dogpile-scrape-jobs\nwrangler queues create dogpile-reindex-jobs\n```","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-28T20:33:32.59430306+01:00","updated_at":"2025-12-28T20:51:41.831827357+01:00","dependencies":[{"issue_id":"dogpile-qv7","depends_on_id":"dogpile-47n","type":"blocks","created_at":"2025-12-28T20:33:47.851928654+01:00","created_by":"daemon"}]}
{"id":"dogpile-s01","title":"Build dog listing and detail pages","description":"Complete the web frontend:\n\n1. Dog listing page with filters:\n   - City/distance sorting\n   - Size, breed, age filters\n   - Urgent flag filter\n   - Infinite scroll or pagination\n\n2. Dog detail page:\n   - Full photo gallery\n   - All extracted data displayed\n   - Breed confidence bars\n   - Compatibility badges\n   - Link to shelter/source","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T20:34:12.203833526+01:00","updated_at":"2025-12-29T00:15:00.636796818+01:00","closed_at":"2025-12-29T00:15:00.636796818+01:00","close_reason":"Created Astro pages for dog listing and detail views"}
{"id":"dogpile-u1d","title":"Create AI configuration system","description":"Create configuration system for AI models using Effect.Config.\n\n## Environment Variables\n```\nOPENROUTER_API_KEY=sk-...                           # Required, secret\n\n# Models (all with reasoning enabled where supported)\nMODEL_TEXT_EXTRACTION=x-ai/grok-4.1-fast            # Extract data from shelter text\nMODEL_PHOTO_ANALYSIS=google/gemini-3-flash-preview  # Analyze dog photos  \nMODEL_DESCRIPTION_GEN=google/gemini-3-flash-preview # Generate dog bios\nMODEL_EMBEDDING=google/gemini-embedding-001         # Vector embeddings\n```\n\n## Implementation\n1. Create AIConfig type with all model settings\n2. Use Effect.Config with defaults for each model\n3. Create .env.example with all variables documented\n4. Update all wrangler.toml files with [vars] defaults\n5. Document how to set secrets via 'wrangler secret put'\n\n## Effect Pattern\n```typescript\nexport const AIConfig = Config.all({\n  apiKey: Config.redacted('OPENROUTER_API_KEY'),\n  textExtractionModel: Config.string('MODEL_TEXT_EXTRACTION').pipe(\n    Config.withDefault('x-ai/grok-4.1-fast')\n  ),\n  photoAnalysisModel: Config.string('MODEL_PHOTO_ANALYSIS').pipe(\n    Config.withDefault('google/gemini-3-flash-preview')\n  ),\n  descriptionGenModel: Config.string('MODEL_DESCRIPTION_GEN').pipe(\n    Config.withDefault('google/gemini-3-flash-preview')\n  ),\n  embeddingModel: Config.string('MODEL_EMBEDDING').pipe(\n    Config.withDefault('google/gemini-embedding-001')\n  ),\n})\n```\n\n## Reasoning Mode\nFor models that support it, enable reasoning in the request:\n```typescript\n{\n  model: 'google/gemini-3-flash-preview',\n  reasoning: { effort: 'medium' }  // or as per OpenRouter docs\n}\n```\n\nLocation: packages/core/src/config/ai.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:41:54.125348984+01:00","updated_at":"2025-12-28T21:00:46.214966217+01:00","closed_at":"2025-12-28T21:00:46.214966217+01:00","close_reason":"Created AIConfig with model configuration using Effect.Config"}
{"id":"dogpile-we6","title":"Implement PhotoAnalyzer service","description":"Create PhotoAnalyzer Effect service for extracting physical traits from dog photos.\n\n## Depends on\n- OpenRouterClient (dogpile-czv)\n- JSON Schemas (dogpile-ogp)\n- AI Config (dogpile-u1d)\n\n## Interface\n```typescript\ninterface PhotoAnalyzer {\n  analyze: (photoUrls: readonly string[]) =\u003e Effect\u003cPhotoExtractionResult, ExtractionError\u003e\n  analyzeSingle: (photoUrl: string) =\u003e Effect\u003cPhotoExtractionResult, ExtractionError\u003e\n}\n```\n\n## Implementation\n1. Use OpenRouterClient.responses() with MODEL_PHOTO_ANALYSIS\n2. Pass images via URL (OpenRouter/Gemini support image URLs directly)\n3. If multiple photos, analyze best one or merge results\n4. response_format: { type: 'json_schema', json_schema: PhotoExtractionSchema }\n5. Validate with Effect Schema decoder\n\n## Considerations\n- Prefer image URLs over base64 (token efficiency)\n- If shelter images are not public, may need to proxy through R2\n- Handle poor quality / multiple dogs in photo gracefully\n- Extract confidence levels for breed estimates\n\nLocation: packages/core/src/services/ai/photo-analyzer.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:42:38.325125066+01:00","updated_at":"2025-12-28T21:07:22.980856666+01:00","closed_at":"2025-12-28T21:07:22.980856666+01:00","close_reason":"Implemented PhotoAnalyzer with image input support","dependencies":[{"issue_id":"dogpile-we6","depends_on_id":"dogpile-czv","type":"blocks","created_at":"2025-12-28T20:43:21.92676925+01:00","created_by":"daemon"},{"issue_id":"dogpile-we6","depends_on_id":"dogpile-u1d","type":"blocks","created_at":"2025-12-28T20:43:21.941276945+01:00","created_by":"daemon"},{"issue_id":"dogpile-we6","depends_on_id":"dogpile-ogp","type":"blocks","created_at":"2025-12-28T20:43:21.955347476+01:00","created_by":"daemon"},{"issue_id":"dogpile-we6","depends_on_id":"dogpile-ada","type":"blocks","created_at":"2025-12-28T20:51:25.198645434+01:00","created_by":"daemon"}]}
{"id":"dogpile-zv5","title":"Implement TextExtractor service","description":"Create TextExtractor Effect service for extracting structured dog data from shelter text.\n\n## Depends on\n- OpenRouterClient (dogpile-czv)\n- JSON Schemas (dogpile-ogp)\n- AI Config (dogpile-u1d)\n\n## Interface\n```typescript\ninterface TextExtractor {\n  extract: (rawDescription: string) =\u003e Effect\u003cTextExtractionResult, ExtractionError\u003e\n}\n```\n\n## Implementation\n1. Use OpenRouterClient.responses() with MODEL_TEXT_EXTRACTION\n2. System prompt: extraction instructions with examples\n3. User message: the raw shelter description\n4. response_format: { type: 'json_schema', json_schema: TextExtractionSchema }\n5. Parse response with Effect Schema decoder\n6. Map errors appropriately\n\n## Prompt Engineering\n- Handle Polish language text\n- Extract all possible fields, use null for missing\n- Recognize common Polish shelter terminology\n- Handle inconsistent formatting gracefully\n\nLocation: packages/core/src/services/ai/text-extractor.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:42:26.005652745+01:00","updated_at":"2025-12-28T21:07:22.951423499+01:00","closed_at":"2025-12-28T21:07:22.951423499+01:00","close_reason":"Implemented TextExtractor with OpenRouter structured output","dependencies":[{"issue_id":"dogpile-zv5","depends_on_id":"dogpile-czv","type":"blocks","created_at":"2025-12-28T20:43:21.87739281+01:00","created_by":"daemon"},{"issue_id":"dogpile-zv5","depends_on_id":"dogpile-u1d","type":"blocks","created_at":"2025-12-28T20:43:21.897090493+01:00","created_by":"daemon"},{"issue_id":"dogpile-zv5","depends_on_id":"dogpile-ogp","type":"blocks","created_at":"2025-12-28T20:43:21.912233902+01:00","created_by":"daemon"},{"issue_id":"dogpile-zv5","depends_on_id":"dogpile-ada","type":"blocks","created_at":"2025-12-28T20:51:25.176184686+01:00","created_by":"daemon"}]}
